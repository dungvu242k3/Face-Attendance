{% extends "base.html" %}
{% block title %}Nh√¢n vi√™n - Face Attendance{% endblock %}

{% block content %}
<div class="bg-white card p-6">

  <div class="flex justify-between items-center mb-6">
    <h3 class="text-xl font-bold text-gray-800">Danh S√°ch Nh√¢n Vi√™n</h3>

    <div class="flex space-x-2">
      <input type="text" id="searchName" placeholder="T√¨m theo t√™n..."
             class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
      <select id="filterPosition" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
        <option value="">T·∫•t c·∫£ ch·ª©c v·ª•</option>
        {% for pos in positions %}
          <option value="{{ pos }}">{{ pos }}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  {% if employees %}
  <div class="overflow-x-auto">
    <table class="min-w-full text-left">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-3">ID</th>
          <th class="px-4 py-3">T√™n</th>
          <th class="px-4 py-3">Email</th>
          <th class="px-4 py-3">SƒêT</th>
          <th class="px-4 py-3">Ch·ª©c v·ª•</th>
          <th class="px-4 py-3">Ng√†y t·∫°o</th>
          <th class="px-4 py-3">H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
      {% for emp in employees %}
        <tr class="border-b hover:bg-gray-50">
          <td class="px-4 py-3">{{ emp[0] }}</td>
          <td class="px-4 py-3 font-medium">{{ emp[1] }}</td>
          <td class="px-4 py-3">{{ emp[2] or "-" }}</td>
          <td class="px-4 py-3">{{ emp[3] or "-" }}</td>
          <td class="px-4 py-3">{{ emp[4] or "-" }}</td>
          <td class="px-4 py-3 text-sm text-gray-500">{{ emp[5] }}</td>
          <td class="px-4 py-3">
            <a href="{{ url_for('edit_employee', emp_id=emp[0]) }}" class="text-blue-600 hover:underline">‚úèÔ∏è S·ª≠a</a>
            <button class="delete-btn text-red-600 hover:underline ml-2" data-emp-id="{{ emp[0] }}">üóëÔ∏è X√≥a</button>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div class="text-gray-500 text-center py-10">Ch∆∞a c√≥ nh√¢n vi√™n n√†o</div>
  {% endif %}
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

  const nameInput = document.getElementById('searchName');
  const positionSelect = document.getElementById('filterPosition');

  function filterEmployees() {
    const name = nameInput.value.toLowerCase();
    const position = positionSelect.value;
    const rows = document.querySelectorAll('tbody tr');

    rows.forEach(row => {
      const rowName = row.children[1].textContent.toLowerCase();
      const rowPosition = row.children[4].textContent;

      const matchName = rowName.includes(name);
      const matchPosition = !position || rowPosition === position;

      row.style.display = matchName && matchPosition ? '' : 'none';
    });
  }

  nameInput.addEventListener('input', filterEmployees);
  positionSelect.addEventListener('change', filterEmployees);

  const deleteButtons = document.querySelectorAll('.delete-btn');
  deleteButtons.forEach(button => {
    button.addEventListener('click', function() {
      const empId = this.getAttribute('data-emp-id');
      if (!confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a nh√¢n vi√™n n√†y?")) return;

      fetch(`/admin/delete_employee/${empId}`, { method: "POST" })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            alert(data.message);
            this.closest('tr').remove();
            filterEmployees();
          } else {
            alert(data.message || "X√≥a th·∫•t b·∫°i");
          }
        })
        .catch(() => alert("L·ªói k·∫øt n·ªëi, th·ª≠ l·∫°i sau"));
    });
  });

});
</script>
{% endblock %}
